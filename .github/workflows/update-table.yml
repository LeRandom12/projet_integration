name: Auto-update de index.html depuis contact.json

on:
  push:
    paths:
      - "contact.json"

jobs:
  update-html:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout du code
        uses: actions/checkout@v4

      - name: Conversion contact.json → tableau HTML
        uses: Teebra/JSON-to-HTML-table@v2.0.0
        with:
          json-file: contact.json

      - name: Injection du tableau généré dans index.html
        run: |
          echo "Injection du tableau dans index.html..."
          TABLE=$(cat output.html)
          awk -v table="$TABLE" '
            /<tbody id='\''__pushctn'\''>/ {print; print table; skip=1; next}
            /<\/tbody>/ {skip=0}
            !skip
          ' index.html > index.new.html
          mv index.new.html index.html
          echo "index.html mis à jour"

      - name: Commit & push si changement
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add index.html output.html || true
          if git diff --cached --quiet; then
            echo "Aucun changement"
          else
            git commit -m "Auto-update index.html depuis contact.json"
            git push
          fi
